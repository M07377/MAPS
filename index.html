<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Philippines Map — Interactive Atlas</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous">
  <style>
    :root{
      --bg:#07080b;
      --panel:#0f1116;
      --panel2:#141821;
      --text:#eef2f6;
      --muted:#9aa4af;
      --gold:#ffd166;
      --cyan:#4cc9f0;
      --mag:#b5179e;
      --border: rgba(255,255,255,0.10);
    }
    *{box-sizing:border-box}
    html, body { height:100%; margin:0; background: var(--bg); color: var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif; }
    .app { display:grid; grid-template-columns: 420px 1fr; height:100%; }
    @media (max-width: 1060px) { .app { grid-template-columns: 1fr; } }

    .topbar{
      position: fixed; z-index: 1000; top:0; left:0; right:0;
      height:60px; display:flex; align-items:center; justify-content:space-between;
      padding: 0 16px; background: linear-gradient(180deg, rgba(10,12,16,0.92), rgba(10,12,16,0.6));
      backdrop-filter: blur(6px); border-bottom: 1px solid var(--border);
    }
    .brand{ font-weight:900; letter-spacing:.3px; background: linear-gradient(90deg, var(--cyan), var(--mag)); -webkit-background-clip:text; background-clip:text; color:transparent; }
    .actions{ display:flex; gap:8px; align-items:center; }
    .btn{ background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.03)); border:1px solid var(--border); color:var(--text); padding:8px 10px; border-radius:10px; cursor:pointer; font-weight:700; font-size:13px; }
    .btn:hover{ background: rgba(255,255,255,0.12); }
    .btn.primary{ background: linear-gradient(180deg, rgba(255,209,102,0.2), rgba(255,209,102,0.1)); border-color: rgba(255,209,102,0.6); color:#ffe9b3; }

    .sidebar{ position:relative; z-index:600; height:100%; padding-top:60px; border-right:1px solid var(--border); background: radial-gradient(900px 500px at 0% -10%, rgba(76,201,240,0.06) 0%, transparent 60%) no-repeat, var(--panel); overflow:auto; }
    .side-header{ padding:12px 14px; border-bottom:1px solid var(--border); background: var(--panel2); }
    h1.title{ margin:6px 0 2px; font-size:18px; font-weight:900; }
    p.subtitle{ margin:0; color:var(--muted); font-size:13px; }

    .tabs{ display:flex; gap:8px; padding:10px 14px; border-bottom:1px dashed var(--border); }
    .tab{ padding:8px 12px; border-radius:10px; border:1px solid var(--border); background: rgba(255,255,255,0.05); cursor:pointer; font-weight:700; font-size:13px; }
    .tab.active{ background: linear-gradient(180deg, rgba(76,201,240,0.2), rgba(76,201,240,0.06)); border-color: rgba(76,201,240,0.5); }

    .filters{ padding:10px 14px; display:flex; flex-wrap:wrap; gap:8px; border-bottom:1px dashed var(--border); }
    .badge{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background: rgba(255,255,255,0.04); font-size:12px; cursor:pointer; }
    .badge input{ accent-color: var(--gold); }

    .list{ padding: 12px; display:grid; gap:10px; }
    .card{ display:grid; grid-template-columns: 110px 1fr; gap:10px; padding:10px; border:1px solid var(--border); border-radius:14px; background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); cursor:pointer; }
    .thumb{ width:100%; height:80px; border-radius:10px; overflow:hidden; background:#0d0f13; }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .meta .name{ font-weight:800; font-size:14px; }
    .meta .zh{ color:#cbd5e1; font-size:12px; }
    .meta .mini{ color: var(--muted); font-size:12px; margin-top:4px; }
    .chip{ display:inline-block; padding:3px 8px; border-radius:999px; background: rgba(255,255,255,0.06); border:1px solid var(--border); margin-top:6px; font-size:11px; }

    .mapwrap{ position:relative; height:100%; }
    #map{ width:100%; height:100vh; min-height:600px; }
    html, body, #map { height:100%; }
    .lantern-layer{ position:absolute; inset:0; pointer-events:none; z-index: 400; }

    .leaflet-control-attribution{ background: rgba(12,13,18,0.65); backdrop-filter: blur(4px); color:#cbd5e1; }
    .leaflet-popup-content-wrapper, .leaflet-popup-tip { background: #0f1116; color:#e2e8f0; border: 1px solid var(--border); }
    .popup img{ width:100%; height:auto; border-radius:10px; margin: 6px 0 4px; }
    .popup .title{ font-weight:900; color: var(--gold); }
    .popup .desc{ color:#cbd5e1; font-size: 13px; }
    .popup .tag{ display:inline-block; font-size:11px; padding:2px 6px; border:1px solid var(--border); border-radius:999px; background: rgba(255,255,255,0.05); margin-top:6px; }

    .credits{ display:none; padding:10px; color:var(--muted); font-size:12px; border-top:1px dashed var(--border); }
    @media (min-width: 1061px){ .credits{ display:block; } }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand">Philippines Map — Interactive Atlas</div>
    <div class="actions">
      <button class="btn" id="musicBtn" title="Ambient music on/off">Music: Off</button>
      <button class="btn" id="tourBtn" title="Fly tour">Fly Tour</button>
      <button class="btn" id="routeBtn" title="Show route">Route</button>
      <button class="btn primary" id="langBtn" title="English / Tagalog">Tagalog</button>
    </div>
  </div>

  <div class="app">
    <aside class="sidebar">
      <div class="side-header">
        <h1 class="title" id="title">Highlights & Food</h1>
        <p class="subtitle" id="subtitle">Use the tabs & filters. Click a card to fly the map and open details.</p>
      </div>

      <div class="tabs">
        <button class="tab active" id="tabLandmarks">Landmarks</button>
        <button class="tab" id="tabFood">Food & Drinks</button>
      </div>

      <div class="filters" id="filters"></div>
      <div class="list" id="cardList"></div>

      <div class="credits">
        Photos © Wikimedia Commons (CC BY-SA). Map © OpenStreetMap contributors. Basemap © Carto.
      </div>
    </aside>

    <main class="mapwrap">
      <div id="map"></div>
      <canvas class="lantern-layer" id="lanterns"></canvas>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous"></script>
  <script>
    // ---------------- Language ----------------
    let tl = false; // Tagalog off by default
    function t(en, tlz){ return tl ? tlz : en; }

    // ---------------- Landmarks (nationwide) ----------------
    const landmarks = [
      // LUZON
      { id:'intramuros', region:'Luzon', cat:'Heritage', name:{en:'Intramuros & Fort Santiago — Manila', tl:'Intramuros at Fort Santiago — Maynila'}, coords:[14.5924,120.9737],
        img:'https://upload.wikimedia.org/wikipedia/commons/1/1b/Fort_Santiago_Gate%2C_Intramuros%2C_Manila.jpg',
        desc:{en:'Walled city of Manila; Spanish-era bastions, plazas, and stone streets.', tl:'Sinaunang pader ng Maynila; mga bastion, plasa, at batong kalsada mula sa panahon ng Kastila.'} },
      { id:'rizalpark', region:'Luzon', cat:'City Park', name:{en:'Rizal Park (Luneta) — Manila', tl:'Rizal Park (Luneta) — Maynila'}, coords:[14.5827,120.9781],
        img:'https://upload.wikimedia.org/wikipedia/commons/5/5a/Ph_ncr_manila_rizal_park.jpg',
        desc:{en:'Iconic monument and green heart of the city by the bay.', tl:'Tanyag na monumento at luntiang puso ng lungsod sa may look.'} },
      { id:'sanagustin', region:'Luzon', cat:'UNESCO', name:{en:'San Agustin Church — Intramuros', tl:'Simbahan ng San Agustin — Intramuros'}, coords:[14.5896,120.9749],
        img:'https://upload.wikimedia.org/wikipedia/commons/3/3f/San_Agustin_Church_%28Intramuros%29.jpg',
        desc:{en:'Oldest stone church in the country; a Baroque World Heritage site.', tl:'Pinakamatandang batong simbahan sa bansa; Bahagi ng Baroque World Heritage.'} },
      { id:'taal', region:'Luzon', cat:'Nature', name:{en:'Taal Volcano & Lake — Batangas/Tagaytay', tl:'Bulkang Taal at Lawa — Batangas/Tagaytay'}, coords:[14.002,120.997],
        img:'https://upload.wikimedia.org/wikipedia/commons/0/0a/PH_Taal_Volcano_Lake_2013.jpg',
        desc:{en:'Dramatic lake-within-a-lake vistas from Tagaytay Ridge.', tl:'Tanawing lawa-sa-loob-ng-lawa mula sa Tagaytay Ridge.'} },
      { id:'banaue', region:'Luzon', cat:'UNESCO', name:{en:'Banaue Rice Terraces — Ifugao', tl:'Hagdan-Hagdang Palayan ng Banaue — Ifugao'}, coords:[16.912,121.053],
        img:'https://upload.wikimedia.org/wikipedia/commons/7/72/Banaue_Rice_Terraces_200512.jpg',
        desc:{en:'2,000-year-old terraces carved into the Cordillera mountains.', tl:'2,000-taong hagdan-hagdang palayan sa kabundukan ng Cordillera.'} },
      { id:'vigan', region:'Luzon', cat:'Heritage', name:{en:'Vigan Heritage Village — Ilocos Sur', tl:'Vigan Heritage Village — Ilocos Sur'}, coords:[17.574,120.387],
        img:'https://upload.wikimedia.org/wikipedia/commons/5/5f/Crisologo_Street%2C_Vigan%2C_Ilocos_Sur.jpg',
        desc:{en:'Calle Crisologo: preserved Spanish colonial houses and calesas.', tl:'Calle Crisologo: napanatiling bahay na kolonyal at mga karwahe.'} },
      { id:'mayon', region:'Luzon', cat:'Nature', name:{en:'Mayon Volcano — Albay', tl:'Bulkang Mayon — Albay'}, coords:[13.257,123.685],
        img:'https://upload.wikimedia.org/wikipedia/commons/6/66/Mayon_Volcano_in_Albay%2C_Philippines.jpg',
        desc:{en:'Perfect cone volcano towering over fields and towns.', tl:'Perpektong konong bulkan na nakahihigit sa mga bukid at bayan.'} },
      { id:'hundredislands', region:'Luzon', cat:'Nature', name:{en:'Hundred Islands National Park — Pangasinan', tl:'Hundred Islands National Park — Pangasinan'}, coords:[16.242,120.039],
        img:'https://upload.wikimedia.org/wikipedia/commons/7/7e/Hundred_Islands_Pangasinan.jpg',
        desc:{en:'Emerald islets scattered off Alaminos — beaches and viewpoints.', tl:'Mga pulong-hiyas sa karagatan ng Alaminos — dalampasigan at tanaw-pook.'} },
      { id:'pinatubo', region:'Luzon', cat:'Nature', name:{en:'Mt. Pinatubo Crater Lake — Zambales', tl:'Lawa sa Bunganga ng Mt. Pinatubo — Zambales'}, coords:[15.142,120.349],
        img:'https://upload.wikimedia.org/wikipedia/commons/1/1f/Mt._Pinatubo_Crater_Lake.jpg',
        desc:{en:'Turquoise crater lake reached by 4x4 and a short trek.', tl:'Asul-berdeng lawa sa bunganga na dinaraanan ng 4x4 at maikling lakad.'} },
      { id:'bangui', region:'Luzon', cat:'Modern', name:{en:'Bangui Windmills — Ilocos Norte', tl:'Bangui Windmills — Ilocos Norte'}, coords:[18.541,120.736],
        img:'https://upload.wikimedia.org/wikipedia/commons/f/f2/Bangui_Windmills_2009.jpg',
        desc:{en:'Giant wind turbines lining the black-sand shore.', tl:'Higanteng turbina ng hangin sa maitim na baybayin.'} },
      // VISAYAS
      { id:'chocohills', region:'Visayas', cat:'Nature', name:{en:'Chocolate Hills — Bohol', tl:'Chocolate Hills — Bohol'}, coords:[9.829,124.165],
        img:'https://upload.wikimedia.org/wikipedia/commons/8/8b/Chocolate_Hills_overview.jpg',
        desc:{en:'Thousands of conical hills that turn brown in the dry season.', tl:'Libo-libong burol na nagiging tsokolate tuwing tag-init.'} },
      { id:'magellans', region:'Visayas', cat:'Heritage', name:{en:'Magellan’s Cross — Cebu City', tl:'Krus ni Magellan — Lungsod ng Cebu'}, coords:[10.294,123.902],
        img:'https://upload.wikimedia.org/wikipedia/commons/8/82/Magellan%27s_Cross_Cebu.JPG',
        desc:{en:'Historic cross marking the arrival of Christianity in 1521.', tl:'Makasaysayang krus na tanda ng pagdating ng Kristiyanismo noong 1521.'} },
      { id:'kawasan', region:'Visayas', cat:'Nature', name:{en:'Kawasan Falls — Badian, Cebu', tl:'Kawasan Falls — Badian, Cebu'}, coords:[9.806,123.376],
        img:'https://upload.wikimedia.org/wikipedia/commons/f/f7/Kawasan_Falls%2C_Cebu.jpg',
        desc:{en:'Turquoise cascades popular for canyoneering.', tl:'Asul-berdeng talon na tanyag sa canyoneering.'} },
      { id:'boracay', region:'Visayas', cat:'Beach', name:{en:'White Beach — Boracay, Aklan', tl:'White Beach — Boracay, Aklan'}, coords:[11.962,121.925],
        img:'https://upload.wikimedia.org/wikipedia/commons/6/60/Boracay_White_Beach_panorama.jpg',
        desc:{en:'Powdery white sand and sunset sails.', tl:'Pino at puting buhangin at mga paraw sa dapithapon.'} },
      { id:'miagao', region:'Visayas', cat:'UNESCO', name:{en:'Miag-ao Church — Iloilo', tl:'Simbahan ng Miag-ao — Iloilo'}, coords:[10.643,122.235],
        img:'https://upload.wikimedia.org/wikipedia/commons/6/6a/Miag-ao_Church.jpg',
        desc:{en:'Baroque fortress church with coconut-tree relief façade.', tl:'Baroque na simbahang parang kuta na may palamuting niyog sa harapan.'} },
      { id:'ruins', region:'Visayas', cat:'Heritage', name:{en:'The Ruins — Talisay, Negros Occidental', tl:'The Ruins — Talisay, Negros Occidental'}, coords:[10.736,122.967],
        img:'https://upload.wikimedia.org/wikipedia/commons/9/9a/The_Ruins_Talisay.jpg',
        desc:{en:'Romantic shell of a 1900s mansion, lit warmly at night.', tl:'Romantikong guho ng mansyong 1900s, maliwanag sa gabi.'} },
      // MINDANAO
      { id:'apo', region:'Mindanao', cat:'Nature', name:{en:'Mount Apo — Davao', tl:'Bundok Apo — Davao'}, coords:[6.987,125.269],
        img:'https://upload.wikimedia.org/wikipedia/commons/2/21/Mount_Apo.jpg',
        desc:{en:'Highest mountain in the Philippines with cloud forests.', tl:'Pinakamataas na bundok sa bansa na may ulap-gubat.'} },
      { id:'siargao', region:'Mindanao', cat:'Beach', name:{en:'Cloud 9 Boardwalk — Siargao', tl:'Cloud 9 Boardwalk — Siargao'}, coords:[9.818,126.170],
        img:'https://upload.wikimedia.org/wikipedia/commons/7/79/Cloud_9_Siargao.jpg',
        desc:{en:'Surfing mecca with iconic pier and reef breaks.', tl:'Pook-surfing na may tanyag na tulay at alon sa bahura.'} },
      { id:'tinuyan', region:'Mindanao', cat:'Nature', name:{en:'Tinuy-an Falls — Surigao del Sur', tl:'Tinuy-an Falls — Surigao del Sur'}, coords:[8.673,126.162],
        img:'https://upload.wikimedia.org/wikipedia/commons/3/3f/Tinuy-an_Falls_Bislig.jpg',
        desc:{en:'Wide, multi-tiered waterfall called the “Niagara of the Philippines.”', tl:'Malapad at patong-patong na talon — “Niagara ng Pilipinas.”'} },
      { id:'pilar', region:'Mindanao', cat:'Heritage', name:{en:'Fort Pilar — Zamboanga City', tl:'Fort Pilar — Lungsod ng Zamboanga'}, coords:[6.904,122.079],
        img:'https://upload.wikimedia.org/wikipedia/commons/1/1d/Fort_Pilar_Shrine_Zamboanga.jpg',
        desc:{en:'17th‑century Spanish-era fort and Marian shrine.', tl:'Ika-17 siglong kuta ng Kastila at dambana ni Maria.'} },
      { id:'mariacristina', region:'Mindanao', cat:'Nature', name:{en:'Maria Cristina Falls — Iligan', tl:'Maria Cristina Falls — Iligan'}, coords:[8.190,124.215],
        img:'https://upload.wikimedia.org/wikipedia/commons/f/f0/Maria_Cristina_Falls_Iligan.jpg',
        desc:{en:'Twin-drop waterfall powering a hydroelectric plant.', tl:'Kambal na bagsak ng talon na nagpapakuryente sa planta.'} },
      { id:'lakesebu', region:'Mindanao', cat:'Nature', name:{en:'Lake Sebu — South Cotabato', tl:'Lawa ng Sebu — Timog Cotabato'}, coords:[6.226,124.714],
        img:'https://upload.wikimedia.org/wikipedia/commons/0/08/Lake_Sebu_South_Cotabato.jpg',
        desc:{en:'Cool highland lake with T’boli culture and zipline views.', tl:'Malamig na lawa sa kabundukan — kultura ng T’boli at zipline tanawin.'} }
    ];

    // ---------------- Food (nationwide icons) ----------------
    const food = [
      { id:'lechon', region:'Visayas', cat:'Specialty', name:{en:'Lechon — Cebu', tl:'Lechon — Cebu'}, coords:[10.31,123.89],
        img:'https://upload.wikimedia.org/wikipedia/commons/5/5c/Lechon_Cebu.jpg',
        desc:{en:'Crisp-skinned roasted pig; fiesta centerpiece.', tl:'Malutong na inihaw na baboy; bida sa pista.'} },
      { id:'batchoy', region:'Visayas', cat:'Noodles', name:{en:'La Paz Batchoy — Iloilo', tl:'La Paz Batchoy — Iloilo'}, coords:[10.71,122.56],
        img:'https://upload.wikimedia.org/wikipedia/commons/0/0f/La_Paz_Batchoy.jpg',
        desc:{en:'Rich noodle soup with pork, offal, chicharrón.', tl:'Malinamnam na sabaw na may pansit, laman-loob, at chicharrón.'} },
      { id:'inasal', region:'Visayas', cat:'Grill', name:{en:'Chicken Inasal — Bacolod', tl:'Chicken Inasal — Bacolod'}, coords:[10.68,122.95],
        img:'https://upload.wikimedia.org/wikipedia/commons/7/73/Chicken_inasal.jpg',
        desc:{en:'Garlic–calamansi–annatto grilled chicken.', tl:'Manok na iniihaw sa calamansi, achuete, at bawang.'} },
      { id:'adobo', region:'Luzon', cat:'Dish', name:{en:'Chicken/Pork Adobo — Manila', tl:'Adobong Manok/Baboy — Maynila'}, coords:[14.6,120.98],
        img:'https://upload.wikimedia.org/wikipedia/commons/3/3a/Chicken_adobo.jpg',
        desc:{en:'Soy-vinegar braise with bay leaves and pepper.', tl:'Paksiw sa toyo at suka na may dahon ng laurel at paminta.'} },
      { id:'sinigang', region:'Luzon', cat:'Soup', name:{en:'Sinigang — Metro Manila', tl:'Sinigang — Kalakhang Maynila'}, coords:[14.58,121.07],
        img:'https://upload.wikimedia.org/wikipedia/commons/0/03/Sinigang_na_Baboy.jpg',
        desc:{en:'Tamarind-sour soup with pork or shrimp.', tl:'Maasim na sabaw na karaniwang may baboy o hipon.'} },
      { id:'halo', region:'Luzon', cat:'Dessert', name:{en:'Halo-halo — Quezon City', tl:'Halo-halo — Lungsod Quezon'}, coords:[14.65,121.03],
        img:'https://upload.wikimedia.org/wikipedia/commons/5/57/Halo-halo.jpg',
        desc:{en:'Crushed ice dessert with fruits, beans, flan, ice cream.', tl:'Pampalamig na yelo na may prutas, beans, leche flan, at sorbetes.'} },
      { id:'bicol', region:'Luzon', cat:'Spicy', name:{en:'Bicol Express — Albay', tl:'Bicol Express — Albay'}, coords:[13.14,123.74],
        img:'https://upload.wikimedia.org/wikipedia/commons/3/3c/Bicol_Express.jpg',
        desc:{en:'Coconut milk stew with chilies and pork.', tl:'Gatang ulam na maanghang na may baboy.'} },
      { id:'durian', region:'Mindanao', cat:'Fruit', name:{en:'Durian — Davao', tl:'Durian — Davao'}, coords:[7.073,125.612],
        img:'https://upload.wikimedia.org/wikipedia/commons/6/6b/Durian.jpg',
        desc:{en:'King of fruits — pungent, creamy, unforgettable.', tl:'Hari ng prutas — matapang ang amoy, napakakrema, di malilimutan.'} },
      { id:'kinilaw', region:'Mindanao', cat:'Seafood', name:{en:'Kinilaw — Northern Mindanao', tl:'Kinilaw — Hilagang Mindanao'}, coords:[8.48,124.65],
        img:'https://upload.wikimedia.org/wikipedia/commons/6/6e/Kinilaw.jpg',
        desc:{en:'Citrus–vinegar “raw” fish salad with chilies and ginger.', tl:'Hilot sa suka at citrus na isdang hilaw na may sili at luya.'} }
    ];

    // ---------------- Map Init ----------------
    const map = L.map('map', { zoomControl: true, attributionControl: true }).setView([12.8, 122.3], 5.3);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap contributors &copy; CARTO'
    }).addTo(map);

    // ---------------- State & UI ----------------
    let activeTab = 'Landmarks';
    let activeCats = new Set();
    const filtersEl = document.getElementById('filters');
    const listEl = document.getElementById('cardList');

    const tabLandmarks = document.getElementById('tabLandmarks');
    const tabFood = document.getElementById('tabFood');
    const titleEl = document.getElementById('title');
    const subtitleEl = document.getElementById('subtitle');

    function getData(){ return activeTab === 'Landmarks' ? landmarks : food; }

    function buildFilters(){
      filtersEl.innerHTML = '';
      const cats = [...new Set(getData().map(p => p.cat))].sort();
      if (activeCats.size === 0) cats.forEach(c => activeCats.add(c));
      cats.forEach(cat => {
        const label = document.createElement('label');
        label.className = 'badge';
        label.innerHTML = `<input type="checkbox" ${activeCats.has(cat)?'checked':''} data-cat="${cat}"><span>${cat}</span>`;
        filtersEl.appendChild(label);
        label.querySelector('input').addEventListener('change', e => {
          const c = e.target.getAttribute('data-cat');
          if (e.target.checked) activeCats.add(c); else activeCats.delete(c);
          renderCards(); applyFilter();
        });
      });
    }

    // ---------------- Markers & Popups ----------------
    const group = L.layerGroup().addTo(map);
    const markerById = new Map();
    function popupHTML(p){
      return `
        <div class="popup">
          <div class="title">${p.name[tl?'tl':'en']}</div>
          <div class="tag">${p.region} • ${p.cat}</div>
          <img src="${p.img}" alt="${p.name.en}">
          <div class="desc">${p.desc[tl?'tl':'en']}</div>
        </div>`;
    }
    function buildMarkers(){
      group.clearLayers(); markerById.clear();
      [...landmarks, ...food].forEach(p => {
        const m = L.marker(p.coords).bindPopup(popupHTML(p));
        m.addTo(group); markerById.set(p.id, m);
        m.on('click', () => highlightCard(p.id));
      });
      applyFilter();
    }
    buildMarkers();

    function applyFilter(){
      group.clearLayers();
      const allowed = new Set(getData().filter(p => activeCats.has(p.cat)).map(p=>p.id));
      [...landmarks, ...food].forEach(p => {
        const m = markerById.get(p.id);
        const inTab = (activeTab==='Landmarks' && landmarks.includes(p)) || (activeTab==='Food' && food.includes(p));
        if (m && inTab && allowed.has(p.id)) m.addTo(group);
      });
    }

    // ---------------- Sidebar ----------------
    function renderCards(){
      listEl.innerHTML='';
      const filtered = getData().filter(p => activeCats.has(p.cat));
      filtered.forEach((p) => {
        const card = document.createElement('div');
        card.className = 'card'; card.dataset.id = p.id;
        const thumb = document.createElement('div'); thumb.className='thumb';
        const img = document.createElement('img'); img.src = p.img; img.alt = p.name.en; thumb.appendChild(img);
        const meta = document.createElement('div'); meta.className='meta';
        const name = document.createElement('div'); name.className='name'; name.textContent = p.name[tl?'tl':'en'];
        const zhline = document.createElement('div'); zhline.className='zh'; zhline.textContent = p.region + ' • ' + p.cat;
        const mini = document.createElement('div'); mini.className='mini'; mini.textContent = t('Click to fly & open details','I-click upang lumipad at buksan ang detalye');
        const chip = document.createElement('div'); chip.className='chip'; chip.textContent = p.cat;
        meta.appendChild(name); meta.appendChild(zhline); meta.appendChild(mini); meta.appendChild(chip);
        card.appendChild(thumb); card.appendChild(meta);
        card.addEventListener('click', () => focusPoint(p));
        listEl.appendChild(card);
      });
    }

    function highlightCard(id){
      const el = [...document.querySelectorAll('.card')].find(x => x.dataset.id === id);
      if (!el) return;
      el.style.outline = '2px solid var(--gold)';
      setTimeout(() => el.style.outline='none', 900);
      el.scrollIntoView({ block:'center', behavior:'smooth' });
    }
    function focusPoint(p){
      map.flyTo(p.coords, 7.3, { duration: 1.3 });
      setTimeout(() => { const m = markerById.get(p.id); if (m) m.openPopup(); }, 1300);
      highlightCard(p.id);
    }

    // ---------------- Route & Tour ----------------
    let route;
    document.getElementById('routeBtn').addEventListener('click', () => {
      if (route) { map.removeLayer(route); route = null; updateButtons(); return; }
      const path = (activeTab==='Landmarks'? landmarks : food).filter(p=>activeCats.has(p.cat)).map(p=>p.coords);
      if (path.length < 2) return;
      route = L.polyline(path, { color: '#ffd166', weight: 4, opacity: 0.9 }).addTo(map);
      map.fitBounds(route.getBounds(), { padding:[30,30] });
      updateButtons();
    });

    let tourTimer = null, tourIdx = 0;
    function startTour(){
      const ordered = getData().filter(p => activeCats.has(p.cat));
      if (!ordered.length) return;
      if (tourTimer) { stopTour(); return; }
      tourIdx = 0;
      tourTimer = setInterval(() => {
        const p = ordered[tourIdx % ordered.length];
        focusPoint(p); tourIdx++;
      }, 2600);
      updateButtons();
    }
    function stopTour(){ clearInterval(tourTimer); tourTimer = null; updateButtons(); }
    document.getElementById('tourBtn').addEventListener('click', () => tourTimer ? stopTour() : startTour());

    function updateButtons(){
      document.getElementById('tourBtn').textContent  = tourTimer ? t('Stop Tour','Itigil ang Tour') : t('Fly Tour','Fly Tour');
      document.getElementById('routeBtn').textContent = route ? t('Hide Route','Itago ang Ruta') : t('Route','Ruta');
      document.getElementById('musicBtn').textContent = t(musicOn?'Music: On':'Music: Off', musicOn?'Musika: Bukas':'Musika: Patay');
      document.querySelector('.brand').textContent = t('Philippines Map — Interactive Atlas','Mapa ng Pilipinas — Interaktibong Atlas');
      titleEl.textContent = t('Highlights & Food','Tampok at Pagkain');
      subtitleEl.textContent = t('Use the tabs & filters. Click a card to fly the map and open details.','Gamitin ang mga tab at filter. I-click ang card upang lumipad ang mapa at buksan ang detalye.');
      tabLandmarks.textContent = t('Landmarks','Mga Pook-Kasaysayan');
      tabFood.textContent = t('Food & Drinks','Pagkain at Inumin');
      document.getElementById('langBtn').textContent = tl ? 'English' : 'Tagalog';
    }

    // ---------------- Tabs ----------------
    function setTab(tab){
      activeTab = tab;
      tabLandmarks.classList.toggle('active', tab==='Landmarks');
      tabFood.classList.toggle('active', tab==='Food');
      activeCats.clear();
      buildFilters();
      renderCards();
      applyFilter();
    }
    tabLandmarks.addEventListener('click', () => setTab('Landmarks'));
    tabFood.addEventListener('click', () => setTab('Food'));
    buildFilters(); renderCards(); applyFilter();

    // ---------------- Language Toggle ----------------
    document.getElementById('langBtn').addEventListener('click', () => {
      tl = !tl;
      renderCards();
      markerById.forEach((m, id) => {
        const p = [...landmarks, ...food].find(x => x.id === id);
        if (p) m.setPopupContent(popupHTML(p));
      });
      updateButtons();
    });
    updateButtons();

    // ---------------- Ambient Music (WebAudio) ----------------
    let audioCtx = null, padOsc = null, padGain = null, chimeOsc = null, chimeGain = null, musicOn = false;
    function initAudio(){
      if (audioCtx) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      padOsc = audioCtx.createOscillator();
      padGain = audioCtx.createGain();
      padOsc.type = 'sine'; padOsc.frequency.value = 196; padGain.gain.value = 0.0; // mellow
      padOsc.connect(padGain).connect(audioCtx.destination); padOsc.start();
      const lfo = audioCtx.createOscillator(); const lfoGain = audioCtx.createGain();
      lfo.frequency.value = 0.05; lfoGain.gain.value = 24; lfo.connect(lfoGain).connect(padOsc.frequency); lfo.start();
      chimeOsc = audioCtx.createOscillator(); chimeGain = audioCtx.createGain();
      chimeOsc.type='triangle'; chimeOsc.frequency.value = 784; chimeGain.gain.value = 0.0;
      chimeOsc.connect(chimeGain).connect(audioCtx.destination); chimeOsc.start();
      setInterval(() => {
        if (!musicOn) return;
        chimeOsc.frequency.setValueAtTime(660 + Math.random()*560, audioCtx.currentTime);
        chimeGain.gain.cancelScheduledValues(audioCtx.currentTime);
        chimeGain.gain.setValueAtTime(0.0, audioCtx.currentTime);
        chimeGain.gain.linearRampToValueAtTime(0.06, audioCtx.currentTime + 0.02);
        chimeGain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.8);
      }, 4200);
    }
    function toggleMusic(){
      if (!audioCtx) initAudio();
      if (!musicOn){
        padGain.gain.cancelScheduledValues(audioCtx.currentTime);
        padGain.gain.setValueAtTime(padGain.gain.value, audioCtx.currentTime);
        padGain.gain.linearRampToValueAtTime(0.05, audioCtx.currentTime + 1.2);
        musicOn = true;
      } else {
        padGain.gain.cancelScheduledValues(audioCtx.currentTime);
        padGain.gain.setValueAtTime(padGain.gain.value, audioCtx.currentTime);
        padGain.gain.linearRampToValueAtTime(0.0001, audioCtx.currentTime + 1.2);
        musicOn = false;
      }
      updateButtons();
    }
    document.getElementById('musicBtn').addEventListener('click', () => toggleMusic());

    // ---------------- Parol-style particles (canvas) ----------------
    const canvas = document.getElementById('lanterns'); const ctx = canvas.getContext('2d');
    let W, H, stars = []; let mouseX = 0.5;
    function resize(){ W = canvas.width = canvas.clientWidth; H = canvas.height = canvas.clientHeight; stars = Array.from({length: 26}, () => makeStar()); }
    function makeStar(){ return { x: Math.random()*W, y: H + Math.random()*H*0.3, r: 6 + Math.random()*10, speed: 12 + Math.random()*18, sway: (Math.random()*0.6 + 0.2) * (Math.random()<0.5?-1:1), alpha: 0.4 + Math.random()*0.5 }; }
    function step(dt){
      ctx.clearRect(0,0,W,H);
      for (const s of stars){
        s.y -= s.speed * dt;
        s.x += Math.sin(s.y * 0.01 + mouseX*2.0) * s.sway;
        const grd = ctx.createRadialGradient(s.x, s.y, 0, s.x, s.y, s.r*3);
        grd.addColorStop(0, `rgba(255,209,102,${0.9*s.alpha})`); grd.addColorStop(1, `rgba(255,209,102,0)`);
        ctx.fillStyle = grd; ctx.beginPath(); ctx.arc(s.x, s.y, s.r*3, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = `rgba(255,180,80,${s.alpha})`; ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI*2); ctx.fill();
        if (s.y < -30) Object.assign(s, makeStar(), { y: H + 20 + Math.random()*50 });
      }
    }
    let prev = performance.now(); function loop(now){ const dt = Math.min(0.05, (now - prev)/1000); prev = now; step(dt); requestAnimationFrame(loop); }
    window.addEventListener('resize', resize); resize(); requestAnimationFrame(loop);
    canvas.addEventListener('mousemove', e => { mouseX = e.clientX / (W||1); });
  </script>
</body>
</html>